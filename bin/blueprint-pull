#!/usr/bin/python

import logging
import optparse
import re
import sys
import urlparse
import string

import blueprint
import blueprint_io

parser = optparse.OptionParser('Usage: %prog <url>')

(options, args) = parser.parse_args()


if 1 != len(args):
    parser.print_usage()
    sys.exit(1)
url = args[0]

pieces = urlparse.urlparse(url)
if not all([pieces.scheme, pieces.netloc]):
	logging.error("The URL is invalid")
	sys.exit(1)
if not set(pieces.netloc) <= set(string.letters + string.digits + '-.'):
	logging.error("The URL has invalid characters")
	sys.exit(1)
if not pieces.scheme in ['http', 'https']:
	logging.error("Please use http or https")
	sys.exit(1)


# TODO: improve error handling
    
try:
    blueprint_io.pull(url)
except IOError:
    pass